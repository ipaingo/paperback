# Предисловие

```
мне на лекции было очень больно это все переписывать, потому что я не догнала один момент и все пошло по одной весьма известной науке траектории
```

Посему заявлю, что все 4 часа мои мысли абсолютно сходились в одну точку...

![[Pasted image 20250224180419.png|200]]

.
.
.
.
.
в общем разжую для себя и для вас. и не говорите потом что от меня никакого проку.

# Рендеринг

Очень советую хотя бы по диагонали прочитать вот [эту](https://render.ru/ru/articles/post/10102) статью. Тут много чего, что было вне лекций, но мне стало немного понятнее что вообще происходит. Крайне занимательное чтиво и то, к чему я стремлюсь в написании сего бреда.

## Телесный угол

![[Pasted image 20250218134645.png]]

Вот есть такое понятие как угол, да? Он может измеряться как в градусах, так и в радианах, и мы все с этим давно уже знакомы. Однако вспомним, что один градус - это центральный угол $1/360$ части круга, а один радиан - это _центральный угол сектора единичной окружности, длина дуги которого равняется 1_. Или на произвольной окружности равняется её радиусу, что в принципе одно и то же. И измеряется такой угол, барабанная дробь, _ни в чем_. Радиан - величина ==безмерная== и гуляет сама по себе и лишь по весне с котом.

По аналогии с плоскостью, если радиан определяется дугой окружности, то ==стерадиан (ср)== (звучит как название какой-то сложной органики, типа бутадиен какой-нибудь) - куском на окружности и не обязательно прямоугольным (настолько прямоугольным, насколько позволяет кривизна сферы как минимум)

И (почти) точно так же, как один радиан "вырезает" из окружности радиуса $r$ дугу длины $r$, так же и стерадиан "вырезает" из сферы радиуса $r$ кусок площадью $r^2$

В контексте всей пары лекций это выглядит как дичайший оффтоп, но тем не менее это там есть и тут тоже пусть будет.

## Вспоминаем физику (немного)

Точно так же, как я описывала в 1ом тервере, заворачиваем всю эту секцию в блок важной инфы и держим её on standby как минимум до конца этого файла

Кореш физик с давно забытыми вышками физмата и физтеха подкинул мне вот эту [видяшку](https://www.youtube.com/watch?v=bPWaGQhvkE8), которую мне еще предстоит посмотреть за каким-нибудь ужином. Наверное там более менее понятно что и как куда зачем.

### Характеристики излучения

```
очень непонятно почему в этой части рассматриваются характеристики электромагнитного излучения в целом, а не характеристики видимого света. там есть нюансы, но i suppose мы все же пойдем в ту сторону дабы не отходить далеко от презентации
```

==Поток излучения== это _не то же самое, что потоки в школьном курсе физике_, измеряется в _ваттах_ of all things и вообще со знакомыми нам потоками его объединяет только то, что это векторное поле. Но понимать это все же надо (как), иначе дальше станет крайне непонятно........

```
это вузовская физика если что. даже не профильная углубленка. брух.......
```

А да, обозначается $\Phi(A)$ и под ним вроде как понимается кол-во энергии э/м излучения, проходящее через точку А за единицу времени, значительно превышающую период э/м колебаний. Иначе говоря, средняя мощность за большое время.

==Облученность== - плотность потока на некоторой площади. Вроде бы понятно по дифференцированию, но полностью осознать у меня не получилось.

$$
E(X) = {d\Phi(A) \over dA(X)}
$$

==Излучательность== - в вики такой величины нет, но как будто бы это то же самое, что и облученность, только не _на_ точку, а _из_ точки.

$$
B(X) = {d\Phi(A) \over dA(X)}
$$

В рамках этого курса $E$ - входящий поток, $B$ - исходящий поток. Оба измеряются в $\text{Вт}/\text{м}^2$, разница в направлении

==Энергетическая яркость== - отношение потока излучения, переносимого в элементарном пучке лучей, проходящем через данную площадку и распространяющемся в телесном угле $d\Omega$, содержащем данное направление, к площади проекции этой площадки на плоскость, перпендикулярную направлению распространения, и величине телесного угла ($\textcopyright$ Википедия)

$$
L(X,\vec{\omega}) = \frac{d^2\Phi(A)}{dA\cos\theta\ d\Omega}
$$

А теперь языком для таких дилетантов как мы: 

![[Pasted image 20250226135234.png|300]]

Имеем бесконечно малую площадку (неповернутый маленький кружочек) и бесконечно малый телесный угол (синий усеченный конус). В формуле выше:

- $\Phi(A)$ - поток (Вт)

- $A\cos\theta$ - площадь проекции площадки на плоскость, перпендикулярную нормали (на картинке это повернутый маленький кружочек) (м^2). Почему косинус, догадайтесь сами, не маленькие уже.

- $\Omega$ - величина телесного угла (ср)

Продифференцируем поток по площадке и по углу (читаем - устремим обе величины в 0) и получим, что площадка схлопнется в точку, а телесный угол - в вектор. Отсюда и оба параметра в левой части

_Конец супер важного блока, начало другого не менее важного блока_

## Индексация буков

В рамках курса лекций используются следующие обозначения (индексы):

- $i$ - падающее (входящее) излучение (incoming)
- $o$ - исходящее излучение (outgoing)
- $r$ - отраженное (reflected)
- $e$ - излучение от источника (emitted)

_В презенташке есть один весьма peculiar моментище. Есть слайд 59, который рисует облученность в сторону точки. А есть слайд 61, который гласит, что $i$-излучение в точке $x$ в направлении $\vec\omega$ равно $o$-излучению из точки $y$ в направлении $-\vec\omega$. И рисунок, изображающий $o$-излучение из $x$. Так вот, весь прикол в том, что $i$-излучение подразумевается входящим в направлении, **противоположном** омега. То есть если бы мы нарисовали траекторию условного луча света, мы бы рисовали против шерсти $\vec\omega$. Интуитивно? нихрена. Но осознать стоит, ибо без этого осознания всё нижеидущее не будет иметь абсолютно никакого сиысла. И тапочки по этому поводу не принимаются._

> TL;DR: $L_i(\omega_i)$ - единственный тип излучения, проходящий _против_ направления вектора. Иначе, $\omega_i$ показывает на _источник_ такого излучения, а не на его destination.

![[Pasted image 20250227120014.png|400]]

Таким образом (совершая очередной logical leap) получаем, что $o$-излучение это $e$-излучение (собственные излучательные способности поверхности) + $r$-излучение (отражаемое поверхностью извне)

А $r$-излучение в свою очередь зависит от $i$-излучения через...

## BRDF

==Bidirectional Reflectance Distribution Function==. Официального перевода на великий и могучий нет, вольных сколько угодно. По-Лукашенковски это "двулучевая функция отражательной способности поверхности", по той статье это "двунаправленная функция распределения отражений", переводим как хотим, в обиходе всё же юзаем аббревиатуру БРДФ.

Что это за монстр? 

Вспомним ещё раз курс школьной физики, а именно тот факт, что абсолютно гладкая поверхность - это не что иное, как очередное модельное допущение, чтобы в геометрической оптике смело заявить, что поскольку угол падения равен углу отражения, мы можем нарисовать зеркало на такой поверхности. Так вот. Угол падения действительно равен углу отражения, только вот сама поверхность "шершавая" (говоря нашим математическим сленгом, реальная нормаль такой поверхности смотрит куда угодно, только не перпендикулярно). И вот это куда угодно и описывает БРДФ. Почти.

Другими словами, поскольку идеально гладких поверхностей не бывает практически нигде, а рассматривать каждую выбоинку в кристаллической решетке можно только пронесши суперкомпьютер в психушку (да и то не факт), то придумали примерную оценку угла отражения, она же БРДФ. Так, это поле вероятных направлений отражения излучения, падающего на поверхность под некоторым углом. Так и нормаль остается на месте, а не скачет аки сайгак в погоне за сохранением угла отражения, и примерная картина отражения света становится понятна.

Формально:

$$
f_r(x, \omega_i, \omega_o) = {dL_r(x,\omega_o) \over dE_i(x,\omega_i)} = {dL_r(x,\omega_o) \over L_i(x,\omega_i)\cos\theta_i d\omega_i}
$$

А неформально это отношение отраженной яркости ко входящей облученности. Википедия говорит, что продифференцировать обе части нужно, чтобы телесный угол в знаменателе схлопнулся в вектор, а стерадиан остался стерадианом (интуитивно это значит, что будет учитываться только излучение, попавшее непосредственно в точку, а не вокруг неё, что на практике невозможно, а в теории вполне себе достижимо и является супер удобным модельным допущением)

Иначе говоря, какая доля входящего света отразилась в указанном направлении.

__Откуда $\theta_i$?__ 

От скольки параметров зависит БРДФ? Вообще в самом классическом варианте от 4х. Считая, что начало координат находится в точке отражения, аппликата смотрит в сторону нормали, а обе омеги имеют единичную длину, имеем для каждой из них огрызки сферических координат в виде углов $\varphi$ и $\theta$. Вот вам и 4 параметра, из которых имеет значение только $\theta_i$ _Точки поверхности в классическом варианте нет._

_Оффтопом вкину инфу о том, что БРДФ от точки википедия называет SVBRDF - Spatially Varying BRDF. Ну то есть мы точку не фиксируем, а двигаем в пространстве и для каждой из них оцениваем БРДФ_

"Формула ясна, идея понятна," - сказал Лукашенко. "...после простыни моих объяснений, надеюсь," - добавлю я. 

## Уравнение рендеринга

```
мне больше нравится формулировка из статьи выше, она как-то более интуитивно воспринимается, поэтому здесь будет именно она, плавно переходящая в типа формальную
```

Наконец-то. А теперь магия. Вспоминаем, что БРДФ - это отношение отраженного света ко входящему (условно) и перепишем это отношение относительно отраженной яркости

$$
dL_r(\omega_o) = f_r \cdot dE_i(\omega_i)
$$

И осознаем, что точка освещается со всех направлений, а не только с одного. Поэтому подменим $dE_i$ на кусок с косинусом и проинтегрируем правую часть по всем углам в полусфере (в лекции она обозначена $H^2$, это ужасно кринжово, но ладно)

$$
L_r(\omega_o) = \int_{\Omega} f_r \cdot L_i(\omega_i) \cos\theta_i\ d\omega_i
$$

_в статье говорится про скалярное произведение $\omega_i$ и нормали, оно же этот косинус_

А теперь вспомним, что $o=e+r$:

$$
L_o(\omega_o) = L_e(\omega_o) + \int_{\Omega} f_r \cdot L_i(\omega_i) \cos\theta_i\ d\omega_i
$$

И получаем в сухом остатке этого же монстра из презентации (и да, мне все равно больше нравится $\Omega$, а не $H^2$, потому что это как бы сборище всех маленьких омег, ну да ладно)

# Частный случай: Ambient Occlusion
Или полностью диффузное рассеивание. Характеризуется постоянным значением БРДФ.

> [!Important] Перед тем, как начать читать этот раздел
> В лекциях нигде не сказано, и даже сам Лукашенко никак не акцентировал этот вопрос, из-за чего мне никак не удавалось осознать что к чему тут происходит. А момент крайне важный и без него лыжи действительно могут не поехать.
> 
> Так вот, ambient occlusion рассматривает _равномерное освещение со всех сторон_. Да, БРДФ может быть константой и при другом освещении, и читатель при наличии должного желания и отсутствии инстинкта самосохранения может рассмотреть такой случай. Но здесь рассматривается именно то, зачем технику применяют при реальной обработке трехмерной графики - а именно придать объем тем участкам сцены, куда не падает свет напрямую, а только отраженный миллионы раз и соответственно допускается, что равномерно и отовсюду. Даже здесь ЗБЧ пригождается шоб его.
> 
> ![[Pasted image 20250303180343.png]]
> 
> [Пикчи отсюда](http://www.aaa-studio.eu/furryball4help/index.html?LightNode2.html)
> 
> Именно поэтому $L_i(\omega_i)$ константа и судя по выкладкам ниже приравнивается к единице. Экзистенциальный кризис автора по этому поводу можно найти где-то там среди сего бреда и гаданий на килограммах кофейной гущи, которые оставляет в качестве отходов лабопроизводства среднестатистический студент.


Что значит постоянная БРДФ? А то, что свет отражается по всем направлениям в одинаковом "количестве" (что на практике звучит весьма far-fetched, но в теории очень удобно). _Отражается всё и равномерно (изотропно)_

> Технические выкладки неинтересны и остаются за вами
> $\textcopyright$ Лукашенко

_А мне так кажется, что в технике вся магия и сложена. Вот если просто так взять и сказать, что эта константа будет равна $1/\pi$, я пожму плечами, отвечу, что наверное так и есть и забуду про этот факт до ~~конца своих дней~~ экзамена. А ведь в этом есть сакральный смысл, как и во всём вышмате в принципе, что я и пытаюсь до тебя, дорогой читатель, донести_

Энивей, $f_r$ константа, а значит её можно вынести за знак интеграла примерно так:

$$
L_o(\omega_o) = L_e(\omega_o) + f_r \cdot \int_{H^2} L_i(\omega_i) \cos\theta_i\ d\omega_i
$$

И оставшийся интеграл это сумма яркостей в телесном углу полусферы, он же облученность $E(x)$, он же излучательность $B(x)$ (ну вот и пригодилась разница между этими понятиями). Через вот этот костыльный нюанс мы заявляем, что сумма всех входящих $i$-излучений равна сумме всех исходящих $r$-излучений (отразилось _всё_ и равномерно)

$$
\int_{H^2} L_i(\omega_i) \cos\theta_i\ d\omega_i = E = B = \int_{H^2} L_r(\omega_r)\cos\theta_r\ d\omega_r
$$

Иначе говоря, подменили $L_i(\omega_i)$ на $L_r(\omega_r)$. А поскольку отраженный свет изотропен (читай - не зависит от угла $\omega_r$ и явл-ся константой), то он опять же выносится за интеграл. Магия? Да походу она самая, я уже ничему не удивляюсь.

_И все большие буковы в последней формуле так же зависят от точки в пространстве. Но это имхо и так понятно, а формула и без них еле влезла. Тапочки по этому поводу не принимаются._

Отраженный свет вылезает за интеграл и уравнение рендеринга принимает вид:

$$
L_o(\omega_o) = L_e(\omega_o) + f_r  L_r \int_{H^2} \cos\theta_r\ d\omega_r
$$

А теперь трэш, который до конца так мной и не осознался.  Если верить моим записям с лекции:

> перейти к сферике, будет синус в якобиане и определенный интеграл по сферическим координатам. синус двойного угла, пределы от 0 до $\pi/2$ потому что полусфера и ещё что-то там куда-то там
> 
> начинали от одних буков пришли к другим и нихрена не видно

Про пределы всё предельно понятно: поскольку имеем дело с полусферой, то и угол $\theta$ (напоминаю, от нормали вниз) надо рассмотреть в промежутке $[0,\pi/2]$. Но как объяснить "переход к сферике", когда мы уже и так рассматриваем сферику, а также синус двойного угла, который должен вытекать из этого же всего? Энивей, забив этот интеграл "втупую", получаем не $\pi$, как было на лекции, а ни много ни мало, барабанная дробь, $2\pi$.......

![[Pasted image 20250228160908.png]]

А если туда подставить якобиан сферики ($r^2\sin\theta$, он же $\sin\theta$ в нашем случае), то действительно получится пол-синуса двойного угла и $\pi$ в интеграле.......

![[Pasted image 20250228161954.png]]

Кто пояснит, откуда взялся переход из декартовых в сферику, когда мы _изначально_ рассматривали зенитный угол векторов (он же угол м/у вектором и нормалью поверхности), тому сертификат на беспричинный тапочек.

Почему-то из этого мы делаем вывод, что раз этот интеграл это $\pi$, то БРДФ должна равняться $1/\pi$. Наверное чтобы у $L_r$ был коэффициент единица, я хз. Но это как будто бы очень похоже на правду, хотя как по мне так это ни что иное, как натягивание совы на глобус. 

_But I digress._

# Обобщение этого бреда

### Модельное допущение номер уно

В прошлом пункте принималось одно достаточно грубое модельное допущение для упрощения и так сложных вычислений. А именно то, что отражается _всё_ входящее излучение (кто помнит физику - все предметы в такой модели абсолютно белые).

Несмотря на последний семестр и дипломы, надо хоть как-то усложнить жизнь студентам, поэтому Лукашенко вводит понятие ==альбедо== - коэффициент отражательной способности поверхности.

```
ничего общего с алхимией и цитрусами у этого альбедо нет. для справки, альбедо в алхимии это очищение или вторая стадия получения философского камня, а у цитрусовых это белая прослойка, которая изнутри корочки. и всё это от лат. albus - белый. 
```

![[Pasted image 20250303120630.png|300]]

жаль что в пдфки не запихать гифки

Итак, альбедо. 

$$
0 \leq \rho \leq 1
$$

где 0 - весь свет поглощается (абсолютно черное тело), а 1 - весь свет отражается (абсолютно белое тело)

И оно должно по идее домножаться на входящую яркость, т.к. входящий свет сначала поглощается, а потом раскидывается по БРДФ. Ну то есть нам по-хорошему было бы закинуть в БРДФ не всю яркость, а только ту часть, которая отражается. Но поскольку БРДФ не зависит от абсолютного значения яркости. то урезать можно не аргумент, а выход. Надеюсь понятно.

Итак, в примере с ambient occlusion БРДФ из $1/\pi$ станет $\rho/\pi$

### Модельное допущение номер дос

Кто ударялся в геймдев, тот помнит, что всю карту сразу рендерить крайне накладно и любой шейдер сразу же положит даже топовую сборку без должной оптимизации. Умные движки типа Unity сами умеют такие оптимизации проворачивать, а вот кто чуть менее умный (или что ещё хуже самопильные движки без гуя) уже не понимают, что они завешивают всю систему к чертям собачим.

Выход? [Frustum culling](https://learnopengl.com/Guest-Articles/2021/Scene/Frustum-Culling). Иначе - исключить из рендера всё, что не видит камера. Так-то это немножко не о том, но суть та же. Истинный frustum culling это _"не рендерь всё, что вне конуса/пирамиды обзора"_

![[Pasted image 20250303122913.png|250]]

А то, про что пойдет сейчас речь - это _"не рендерь всё, что перекрывается другими объектами"_. 

$$
V(x, \omega_i) = \begin{cases}
0, & \quad \text{если есть перекрытие} \\
1, & \quad \text{если перекрытия нет}
\end{cases}
$$

## Всё же обобщение

Поскольку видимость зависит от угла, то она уходит в подынтегральную функцию и (вместе с альбедо) получается следующее недоразумение (как минимум для ambient occlusion)

$$
L_r(\omega_r) = {\rho \over \pi} \int_{H^2} V(\omega_i)\cos\theta_i\ d\omega_i
$$

А теперь внимание вопрос. _Куда потерялась входящая яркость в лекционных материалах??_ Я переписала как было, не факт, что я поняла правильно. Но где-то там же должно фигурировать абсолютное значение входящей яркости, нет? Весь блок с ambient occlusion был посвящен тому, что в этом случае $r$-яркость можно типа приравнять к $i$-яркости (что по идее верно и здесь тоже, с поправкой на альбедо), а функция видимости считается по идее от угла отражения (м/у точкой и камерой).

Короче, take it with a metric ton of salt, кто найдет ошибку, тому буду очень премного благодарна.

[Немного](https://en.wikipedia.org/wiki/Ambient_occlusion) [почитав](https://vr.arvilab.com/blog/ambient-occlusion) [статейки](https://web.archive.org/web/20080926074403/http://www-viz.tamu.edu/students/bmoyer/617/ambocc/), [вроде](https://www.reddit.com/r/GraphicsProgramming/comments/z8ushk/ambient_occlusion_formula/) [как-то](https://docs.google.com/document/d/14xYABb9gY_5xpUe9_9Fb1zWymWlSrcwCXihfGPnGVzM/edit?tab=t.0) [осознала](https://www.cse.chalmers.se/~uffe/xjobb/Joakim%20Carlsson-Realistic%20Ambient%20Occlusion%20In%20Real-Time.pdf)....

Короче, нигде не сказано, но эта модель описывает освещение в виде купола над сценой. То есть представляем полусферу, которая равномерно испускает некоторый постоянный единичный свет вовнутрь и пляшем оттуда. Как мы должны были это понять без миллиона чтива? Хз. Но это так.

Энивей, к чему вся эта катавасия и причем здесь Монте-Карло? А при всем при том, что опять же натягивая сову на глобус, мы можем увидеть, что интеграл в последнем выражении можно положить на шаблон оценки мат. ожидания _и оно почти совпадет с определением мат. ожидания_.

```
хотелось бы конечно положить болт, но пока довольствуемся интегралом
```

Напрямую этот интеграл мы посчитать не можем, так как $V(\omega_i)$ не задана явно (вернее задана, но втупую для каждой точки и омеги, а если так считать, пройдет вечность). Солюшен? Монте-Карло конечно же. Раскидаем маленькие омеги, допустим по $\mathfrak{U}(\Omega)$, посчитаем от них отраженную яркость, прикинем мат. ожидание.

Домножим и поделим подынтегральное выражение на плотность распределения маленьких омег $p(\omega_i) = 1/2\pi$, получим искомое мат. ожидание:

$$
\int_{\Omega}V(\omega_i)\cos\theta_i\ d\omega_i = \mathbb{E} \bigg[{V(\omega_i)\cos\theta_i \over p(\omega_i)}\bigg]
$$

И сделаем его примерную оценку по ЗБЧ:

$$
\mathbb{E} \bigg[{V(\omega_i)\cos\theta_i \over p(\omega_i)}\bigg] ≈ {1 \over n} \sum_{j=1}^{n} {V(\omega_j) \cos\theta_j \over p(\omega_j)}
$$

*Это формула из слайда 66. Там под знаком суммы стоит $\theta_{i,j}$, происхождение которого крайне загадочно для меня. Напоминаю, что $\theta_i$ - это угол м/у нормалью поверхности и $\omega_i$, а косинус этого угла - скалярное произведение этих векторов. В сумме индекс $i$ меняется на $j$ исключительно ради суммирования, но это всё тот же угол падения излучения. Короче, то ли лыжи не едут, то ли я...*

Вот эти две картиночки

![[Pasted image 20250303154334.png]]

Это как раз такая симуляция. Слева объем выборки поменьше, справа побольше, соответственно накладные расходы на вычисления растут в неимоверных масштабах.

# Ещё чуть-чуть обобщим

Это мы рассмотрели одно отражение. А как мы можем догадаться, отражений-то может быть много, и каждое из них задается таким вот душным интегралом. Посчитать в лоб равносильно убиться тапком, которым я в вас кину, если что-то ещё останется непонятно, а я не буду об этом знать.

Отходя морально и от ambient occlusion, имеем всё то же уравнение рендеринга

$$
L_o(\omega_o) = L_e(\omega_o) + \int_{\Omega} f_r \cdot L_i(\omega_i) \cos\theta_i\ d\omega_i
$$

И посмотрим на шаг назад. Вот мы собрали под интегралом входящий свет из полусферы. А что такое этот входящий свет? Это свет, который либо пришел напрямую из источника, либо который отразился ещё от чего-то до этого. В любом случае интеграл выше можно расписать как:

$$
\int_{\Omega}f_r(x,\omega_o,\omega_i) \cdot L_o(y,-\omega_i)\cos\theta_i\ d\omega_i
$$

Здесь $x$ - точка, в которой определяется уравнение рендеринга, а $y$ - точка, из которой вышел луч света, пришедший в $x$ навстречу направлению $\omega_i$. А если картинкой, то

![[Pasted image 20250227120014.png|400]]

И получаем под интегралом такое же $o$-излучение, раскрывающееся в свое же уравнение рендеринга. Если так и дальше раскрывать, упремся в бесконечный интеграл, который на практике тупо ограничивается в количестве итераций

Так, получим несколько отражений, достаточных для более-менее правдоподобного представления, а оставшиеся рекурсии добиваются чем? Say it with me, class. Ambient occlusion. Помните в матане всякие примерные равенства, в которых маленькая разница между требуемым и имеющимся записывается в виде эпсилона, который в теории позволяет ставить равно вместо примерно равно, а на практике игнорируется под предлогом и так сойдет? Так вот тут этот условный эпсилон не игнорируется, а тупо заменяется другим модельным допущением. _И всё_

> Получили алгоритм, называющийся в обиходе ray tracing. Буквально трассировка лучей втупую. Очень похоже на ray marching, но это немножко не то. А именно, ray tracing может использовать при реализации ray marching. Но это так, оффтоп

На слайде 69 имеем несколько картинок с разными компонентами света. Что есть что?

![[Pasted image 20250218145846.png]]

Ряд сверху это слагаемые света, а ряд снизу это сумма всех предыдущих слагаемых. Так, первый столбец это источник света (лампа на потолке сцены), второй это однократное отражение, третий - двухкратное, четвертый - трехкратное.

_На буквы снизу можно сильно не смотреть, это еще один способ понять рекурсивность уравнения рендеринга, чуть более читаемый но чуть менее понятный как по мне. Что-то с операторами, которые как-то по каким-то свойствам раскрываются куда-то там. Короче, если на экзамене вместо этих выкладок потрындеть в моем стиле про сумму отраженных яркостей на разных итерациях отражения, то наверное должно прокатить._

Можно заметить резкое увеличение шума (помех) с увеличением кол-ва отражений. Но об этом следующая лекция.