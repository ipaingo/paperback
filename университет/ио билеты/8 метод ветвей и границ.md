## 8.1 общая схема
## 8.2 решение задачи о коммивояжере методом ветвей и границ

даны $n$ городов, расстояния между которыми известны. необходимо посетить все города по одному разу и вернуться в первый город.

таблица с расстояниями между населенными пунктами, где в ячейках указано расстояние для перехода из $i$-того города в $j$-тый город.
![[1.png]]

задача: перебрать все варианты посещения с минимальными затратами.
решение такой задачи — гамильтонов контур с минимальной стоимостью. 

$1 \underset{16}{\rightarrow} 3 \underset{17}{\rightarrow} 5 \underset{51}{\rightarrow} 6 \underset{9}{\rightarrow} 4 \underset{10}{\rightarrow} 2 \underset{13}{\rightarrow} 1$
$\sum = 116$ 
существует $n!$ вариантов обхода городов.

если у всех элементов строки вычесть одно значение, то сумма уменьшится на это значение, а путь не поменяется.

![[2.png]]

1. нахождение минимальных элементов по строкам.
операция приведения по строкам:
$U_i = \min (C_{ij}),\ j = 1,\ ...,\ n$
$C_{ij}' = C_{ij} - U_i$ — от всех элементов в строчках вычитаем соответствующий минимум.

![[3.png]]

2. нахождение минимальных элементов по столбцам после вычитания по строкам.
операция приведения по столбцам:
$V_j = \min (C_{ij}),\ i = 1,\ ...,\ n$
$C_{ij}'' = C_{ij}' - V_j$
$(C_{ij}'')$ — приведенная матрица. сделали с ней все то же самое, только со столбцами.

3. константа приведения — сумма всех $U_i$ и $V_j$. обозначается $\varphi(\Omega^0) = \underset{i}{\sum} U_i + \underset{j}{\sum} V_j$, где $\Omega$ — все решения, а степень $0$ означает суммы минимумов в строке и столбце.
   решение будет не дешевле $\varphi(\Omega^0)$. (что?)
   в этом случае константа равна $\varphi(\Omega^0) = 35 + 4 = 39$.
![[4.png]]

4. находим степени нулей для каждой матрицы $C''$. для каждого нуля суммируем минимальное значение в строке и столбце и записываем в правый верхний угол: $\Theta_{ij} = \underset{j' \ne j}{\min} (C_{ij}'') + \underset{i' \ne i}{\min} (C_{ij}'')$ 
```
до меня почему-то очень долго доходило, что это значит. короче для каждого нуля, полученного в прошлом шаге, надо посмотреть на строку и на столбец, найти самое маленькое, кроме этого нуля, значение (им может быть другой ноль), сложить вместе и записать.
```
5. выбираем ноль с самым большим числом в углу (максимальной степенью), рассматриваем эту дугу. (напоминаю, что в таблице написаны переходы между городами...)

![[5.png]]
6. взяли в рассмотрение дугу (1, 5). разбиваем множество всех гамильтоновых контуров $\Omega^0$ на $\Omega^1_{i_0 j_0}$ — множество всех решений задачи, которые содержат в себе переход по дуге $i_0 j_0$, и $\Omega^1_{\overline{i_0 j_0}}$ — множество всех решений задачи, которые не содержат в себе переход по дуге $i_0 j_0$. для получения матрицы контуров $\Omega^1_{i_0 j_0}$ (таблица 2.1), которые включают в себя искомую дугу, вычеркиваем в матрице $C''$ строку $i_0$ и столбец $j_0$. чтобы не допустить образования негамильтонового контура, нужно поставить знак бесконечности для той дуги, использование которой может привести к циклу. короче, смотрим, какая строка и какой столбец остались без значка бесконечности, и туда его суем. шоб было.
   
7. считаем константу приведения: $\varphi(\Omega^1_{i_0 j_0}) = \varphi(\Omega^0) + h^1_{i_0 j_0} = 39 + 0 = 39$. что такое $h^1_{i_0 j_0}$, я не поняла.

![[6.png]]

8. строим матрицу для $\Omega^1_{\overline{i_0 j_0}}$ (таблица 2.2). для этого исключаем дугу (1, 5), т. е. заменяем на $\infty$.
9. приводим матрицу.
   $\varphi (\Omega^1_{\overline{i_0 j_0}}) = \varphi(\Omega^0) + h^1_{\overline{i_0 j_0}} = 39 + 5 + 14 = 58$
10. $39 < 58$, а значит, пойдем по ветке, которая использует дугу (1, 5). 

![[7.png]]

11. считаем степени нулей для матрицы $\Omega^1_{i_0 j_0}$ (таблица 2.3). максимальных значений два, выберем понравившийся.

![[8.png]]

12. рассматриваем дугу (6, 3) (таблица 3). считаем константу приведения. $\varphi = 39$

![[9.png]]

13. рассматриваем контур без (6, 3). (таблица 4). приводим матрицу. считаем константу приведения. $\varphi = 49$
14. $39 < 49$, а значит, пойдем по ветке, которая использует дугу (6, 3).

![[10.png]]

15. берем таблицу 3 и считаем степени нулей. наибольшая степени — в дуге (3, 2).

![[11.png]]

16. рассматриваем дугу (3, 2). здесь заменяем на $\infty$ не (2, 3), а (2, 6), потому что (2, 3) и так уже не было, просто пихаем бесконечность туда, где ее не хватало. еее, судоку.

![[12.png]]

17. приводим матрицу. $\varphi = 49$. 

![[13.png]]

18. строим матрицу без дуги (3, 2). приводим. $\varphi = 61$.
19. $49 < 61$, поэтому пойдем по ветке, которая использует дугу (3, 2).

и так далее.

![[14.png]]
## 8.3 решение задачи ЦЛП методом ветвей и границ
$P_0$ — исходная задача.
$\Omega_{P_0}$ — множество допустимых решений исходной задачи.

задачу $P_0$ можно разбить на подзадачи $P_1,\ P_2,\ ...,\ P_k$.

$\Omega_{P_1},\ \Omega_{P_2},\ ...,\ \Omega_{P_k}$ — множества допустимых решений подзадач.

$$\underset{i=1..k}{\bigcup} \large{\Omega_{P_i} = \Omega_{P_0}}$$

$$\large \Omega_{P_i} \normalsize \underset{i \ne j}{\bigcap} \large \Omega_{P_j} = \emptyset,\ i,j=1..k$$

$RP_i$ — релаксированная задача. в ней мы опускаем условие целочисленности.

любую $RP_i$ можно решить симплекс-методом.

$$\large \Omega_{RP_i} \supset \Omega_{P_i}$$

![[8-4.png]]

1. ослабление пространства допустимых решений ЦЛП путем отбрасывания требования целочисленности.
2. решение задачи ЛП и определение ее оптимального решения.
3. имея полученное (непрерывное, не целочисленное) оптимальное решение, добавляем специальное ограничение, которое итерационным путем изменяет пространство допустимых решений задачи ЛП таким образом, чтобы в конечном счете получилось оптимальное решение, удовлетворяющее требованиям целочисленности.
4. ветви, где оценки хуже текущего рекорда, отсекаются.

## конкретизация алгоритма ветвления для задачи ЦЛП.

![[8-5.png]]
$P_0 + x_1 \le 2$ ......................... $P_0 + x_1 \ge 3$

пусть $x^*$ — решение $RP_i$
пусть $x^*_к \not \in \mathbb Z$

$RP_i \underset{\downarrow}{\overset{\uparrow}{|}}\begin{cases}RP_i + \text{условие } x_к \le [x_к^*] \\ RP_i + \text{условие } x_к \ge [x_к^*] + 1\end{cases}$

### пример
$F = 3x_1 + 3x_2 + 13 x_3 \to \max$
$-3x_1 + 6x_2 + 7 x_3 \le 8$
$\ \ \ 6x_1 - 3x_2 + 7x_3 \le 8$
$0 \le x_1,\ x_2,\ x_3 \le 5$, $x_1,\ x_2,\ x_3 \in \mathbb Z$

![[8-6.png]]
![[8-7.png]]
## практические рекомендации
1. аппроксимировать целочисленные переменные вещественными там, где это возможно (переводить в ЛП, сокращать количество целочисленных переменных). этот метод хорошо подходит для решения смешанного целочисленного линейного программирования (СЦЛП). 
2. насколько возможно сузить возможные интервалы допустимых значений целочисленных переменных. это нужно, чтобы меньше вариантов перебирать симплексом.