## 7.1 постановка транспортной задачи (ТЗ). открытая и замкнутая ТЗ

дано:
$m$ складов
$n$ магазинов

товар хранится на складах и развозится по магазинам.

каждому складу соответствует $a_i$ — запас товара на $i$-том складе $(i \in 1..m)$.

каждому магазину соответствует $b_j$ — потребность $j$-того магазина в товаре $(j \in 1..n)$.

$c_{ij}$ — стоимость перевозки единицы товара со склада $i$ в магазин $j$.

$x_{ij}$ — объем перевозки.

таблица:

| склад/магазин | $b_1$    | $b_2$    | ... | $b_n$    |
| ------------- | -------- | -------- | --- | -------- |
| $a_1$         | $c_{11}$ | $c_{12}$ | ... | $c_{1n}$ |
| $a_2$         | $c_{21}$ | $c_{22}$ | ... | $c_{2n}$ |
| ...           | ...      | ...      | ... | ...      |
| $a_m$         | $c_{m1}$ | $c_{m2}$ | ... | $c_{mn}$ |

#### пример


| склад/магазин | 12  | 13  |
| ------------- | --- | --- |
| 10            | 2   | 3   |
| 15            | 4   | 1   |

решения:
$$\left(\begin{array}{cc} 0 & 10 \\ 12 & 3\end{array}\right)\quad \left(\begin{array}{cc} 10 & 0 \\ 2 & 13\end{array}\right)$$

какое лучше?
посчитаем стоимости:

$$\left(\begin{array}{cc} 0 & 30 \\ 48 & 3\end{array}\right) = 81\quad \left(\begin{array}{cc} 20 & 0 \\ 8 & 13\end{array}\right) = 41$$

второе решение более выгодное.

### матмодель

целевая функция — суммарная стоимость перевозок.

$$z = \underset{i=1}{\overset{m}{\sum}} \underset{j=1}{\overset{n}{\sum}} c_{ij} x_{ij} \to \min$$
$$\underset{j=1}{\overset{n}{\sum}} x_{ij} = a_i,\ i \in 1..m$$
$$\underset{i=1}{\overset{m}{\sum}} x_{ij} = b_j,\ j \in 1..n$$
$$x_{ij} \ge 0$$


$$\underset{}{\overset{}{\sum}} a_i = \underset{}{\overset{}{\sum}} b_j = Q \tag{*}$$

когда объемы сбалансированы (см. равенство выше), транспортная задача называется замкнутой (закрытой). иначе задача называется незамкнутой.

любую задачу можно свести к замкнутой.

### 1. избыток товара на складе

пусть $\underset{}{\overset{}{\sum}} a_i > \underset{}{\overset{}{\sum}} b_j$. тогда добавим фиктивный магазин с номером $n+1$, для которого $b_{n+1} = \underset{}{\overset{}{\sum}} a_i - \underset{}{\overset{}{\sum}} b_j$. стоимость перевозки в этот магазин будет равна нулю: $c_{i\ n+1} = 0$. теперь задача замкнутая.

### 2. недостаток товара на складе

пусть $\underset{}{\overset{}{\sum}} a_i < \underset{}{\overset{}{\sum}} b_j$. тогда добавим фиктивный склад с номером $m+1$, для которого $a_{m+1} = \underset{}{\overset{}{\sum}} b_j - \underset{}{\overset{}{\sum}} a_i$. стоимость перевозки из этого склада будет равна нулю: $c_{m+1\ j} = 0$. теперь задача замкнутая.


==закрытая транспортная задача всегда имеет решение.==
вот такое решение (пусть и не будет оптимальным) всегда будет удовлетворять ограничениям задачи.
$$x_{ij} = \dfrac{a_i b_j}{Q}$$

$\underset{i=1}{\overset{m}{\sum}} x_{ij} = \underset{i=1}{\overset{m}{\sum}} \dfrac{a_i b_j}{Q} = \dfrac{b_j}{Q} \cdot \underset{i=1}{\overset{m}{\sum}} a_i = \dfrac{b_j \cdot Q}{Q} = b_j$


## 7.3 алгоритм метода потенциалов
### теорема о потенциалах

матмодель:

$$z = \underset{i=1}{\overset{m}{\sum}} \underset{j=1}{\overset{n}{\sum}} c_{ij} x_{ij} \to \min$$
$$\underset{j=1}{\overset{n}{\sum}} x_{ij} = a_i,\ i \in 1..m$$
$$\underset{i=1}{\overset{m}{\sum}} x_{ij} = b_j,\ j \in 1..n$$
$$x_{ij} \ge 0$$


$$\underset{}{\overset{}{\sum}} a_i = \underset{}{\overset{}{\sum}} b_j = Q$$

в соответствие каждому ограничению по складам поставим новую переменную $u_i$. 

в соответствие каждому ограничению по магазинам поставим новую переменную $v_j$. 

#### теорема
если для базисных клеток выполняется условие $u_i + v_j = c_{ij}$, а для не базисных выполняется условие $u_i + v_j \le c_{ij}$, то текущее решение $x_{ij}$ является оптимальным.

### алгоритм решения транспортной задачи при использовании метода потенциалов

0. привести к замкнутому типу
1. построить начальное БДР транспортной задачи (см. пред. лекция)
   ![[7-1.png | 500]]
2. для базисных
   $u_i + u_j = c_{ij}$
   $m+n-1$, $u \sim m$, $v \sim n$
   пусть $u_1 = 0$
3. для небазисных
   $S_{ij} = c_{ij} - u_i - v_j$
   если все $S_{ij} \ge 0$, то найдено оптимальное решение. иначе переходим к шагу 4.
4. находим минимальное $S_{ij}$, и для клетки, соответствующей данной оценке, строим цикл. ставим в ней пометку "+", далее чередуем пометки "-" и "+".
5. среди клеток со знаком "-" находим минимальное значение перевозки. обозначим его $\lambda = \min\{x_{ij}^-\}$.
6. пересчет транспортной таблицы.
   $$x_{ij}' = \begin{cases}x_{ij} + \lambda,\ x^+ \\ x_{ij} - \lambda,\ x^- \\ x_{ij},\ \text{остальные клетки}\end{cases}$$
   клетку, найденную на шаге 5, исключаем из базиса.
   $z' \le z$
   $z' = z + \underset{\ge 0}{\underbrace{\lambda}} \underset{\le 0}{\underbrace{\cdot \min S_{ij}}}$
   
   если среди оценок небазисных клеток существуют нули, то данное решение не единственно возможное.

### пример

| $\dfrac{\text{магазины} \rightarrow}{\text{склады} \downarrow}$ | 58  | 22  | 18  | 22  |
| --------------------------------------------------------------- | --- | --- | --- | --- |
| 30                                                              | 5   | 8   | 6   | 2   |
| 50                                                              | 2   | 7   | 5   | 3   |
| 40                                                              | 1   | 4   | 3   | 5   |
| 33                                                              | 6   | 5   | 5   | 2   |

приводим к закрытому типу.

|     | 58  | 22  | 18  | 22  | *33* |
| --- | --- | --- | --- | --- | ---- |
| 30  | 5   | 8   | 6   | 2   | *0*  |
| 50  | 2   | 7   | 5   | 3   | *0*  |
| 40  | 1   | 4   | 3   | 5   | *0*  |
| 33  | 6   | 5   | 5   | 2   | *0*  | 

|                 | 58     | 22     | 18     | 22     | 33     | u $\downarrow$ |
| --------------- | ------ | ------ | ------ | ------ | ------ | -------------- |
| ==30==          | 5 / 30 | 8      | 6      | 2      | 0      | ==0==          |
| ==50==          | 2 / 28 | 7 / 22 | 5      | 3      | 0      | ==-3==         |
| ==40==          | 1      | 4 / 0  | 3 / 18 | 5 / 22 | 0      | ==-6==         |
| ==33==          | 6      | 5      | 5      | 2 / 0  | 0 / 33 | ==-9==         |
| v $\rightarrow$ | ==5==  | ==10== | ==9==  | ==11== | ==9==  |                | 

$u_1 + v_1 = 5$
$u_2 + v_1 = 2$
$u_2 + v_2 = 7$
$u_3 + v_2 = 4$
$u_3 + v_3 = 3$
$u_3 + v_4 = 5$
$u_4 + v_4 = 2$
$u_4 + v_5 = 0$

пусть $u_1 = 0$.
посчитать систему можно по таблице.

$S_{12} = c_{12} - u_1 - v_1 = 8 - 0 - 10 = -2$
$S_{13} = -3$
$S_{14} = -9$
$S_{15} = -9$
$S_{23} = -1$
$S_{24} = -5$
$S_{25} = -6$
$S_{31} = 2$
$S_{35} = -3$
$S_{41} = 10$
$S_{42} = 4$
$S_{43} = 5$

есть отрицательные значения, поэтому продолжаем.

пример:
$S_{15} = -9$ (не $S_{14}$ потому что просто захотелось)

построим цикл:


|                 | 58           | 22           | 18        | 22              | 33             | u $\downarrow$ |
| --------------- | ------------ | ------------ | --------- | --------------- | -------------- | -------------- |
| 30              | ==5 / 30== - | 8 ->         | 6 ->      | 2 ->            | ==0== +        | 0              |
| 50              | ==2 / 28== + | ==7 / 22== - | 5         | 3               | 0 $\downarrow$ | -3             |
| 40              | 1            | ==4 / 0== +  | 3 / 18 <- | *==5 / 22==*  - | 0 $\downarrow$ | -6             |
| 33              | 6            | 5            | 5         | ==2 / 0== +     | ==0 / 33== -   | -9             |
| v $\rightarrow$ | 5            | 10           | 9         | 11              | 9              | z = 524        | 

$\lambda = 22$ $(x_{34})$


$0 \lambda - 0 \lambda + 2 \lambda - 5 \lambda + 4 \lambda - 7 \lambda + 2 \lambda - 5 \lambda = -9 \lambda$

$z' = z - 9 \cdot 22 = 524 - 198 = 326$

строим новую матрицу:

|                 | 58                    | 22                | 18     | 22        | 33                      | u $\downarrow$ |
| --------------- | --------------------- | ----------------- | ------ | --------- | ----------------------- | -------------- |
| 30              | ==5 / 8== ->          | 8 ->              | 6 ->   | 2 ->      | ==0 / 22== $\downarrow$ | 0              |
| 50              | ==2 / 50== $\uparrow$ | ==7 / 0== <-      | 5      | 3         | 0 $\downarrow$          | -3             |
| 40              | 1                     | 4 / 22 $\uparrow$ | 3 / 18 | ~~5 / 0~~ | 0 $\downarrow$          | -6             |
| 33              | 6                     | ==5== $\uparrow$  | 5 <-   | 2 / 22 <- | ==0 / 11==              | 0              |
| v $\rightarrow$ | 5                     | 10                | 9      | 2         | 0                       | z = 326        |


не будем прописывать все $S$, просто запишем самого мелкого:
$S_{42} = -5$
$\lambda = 0$

рисуем новую таблицу.

